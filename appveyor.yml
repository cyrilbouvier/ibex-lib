version: build{build}
image: Visual Studio 2015

branches:
  only:
    - appveyor

platform:
  - x86
  - x64

install:
  - cmd: echo %Platform%
  - cmd: set MINGW-W64_BASE=C:\mingw-w64\i686-5.3.0-posix-dwarf-rt_v4-rev0
  - cmd: set PATH=%MINGW-W64_BASE%\mingw32\bin;C:\msys64\usr\bin;%PATH%
  - cmd: uname -a
  - cmd: pacman --noconfirm -S mingw32/mingw-w64-i686-cppunit
  - cmd: set CPATH=%CPATH%;C:\msys64\mingw32\include
  - cmd: set LIBRARY_PATH=%LIBRARY_PATH%;C:\msys64\mingw32\lib
  - cmd: set PREFIX=%HOMEDRIVE%%HOMEPATH%

build_script:
  - cmd: python -x %cd%\waf configure --interval-lib=filib --prefix=%PREFIX%
  - cmd: python -x %cd%\waf build install clean

test_script:
  - cmd: set PKG_CONFIG_PATH=%PREFIX%\share\pkgconfig
  - cmd: ls -l %PREFIX%\lib
  - cmd: ls -l %PREFIX%\lib\ibex
  - cmd: ls -l %PREFIX%\lib\ibex\3rd
  - cmd: set PATH=%PATH%;%PREFIX%\lib;%PREFIX%\lib\ibex;%PREFIX%\lib\ibex\3rd
  - cmd: python -x %cd%\waf utest

on_failure:
  - cmd: ldd C:\\projects\\ibex-lib\\__build__\\tests\\utest_Arith || exit 0
  - cmd: sh -c C:\\projects\\ibex-lib\\__build__\\tests\\utest_Arith || exit 0
  - cmd: set PATH=%PATH%;C:\\projects\\ibex-lib\\__build__\\tests
  - cmd: sh -c C:\\projects\\ibex-lib\\__build__\\tests\\utest_Arith || exit 0
  #- cmd: sh -c __build__\\tests\\utest_Arith || exit 0
  #- cmd: sh -c __build__/tests/utest_Arith || exit 0
  - cmd: cat C:\projects\ibex-lib\__build__\config.log || exit 0
  - cmd: cat C:\projects\ibex-lib\__build__\utest_config.log || exit 0
  - cmd: cat C:\projects\ibex-lib\__build__\utest_run.log || exit 0
